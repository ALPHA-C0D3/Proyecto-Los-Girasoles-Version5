<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Inicia sesi√≥n para acceder a tu cuenta y gestionar tus reservas">
    <title>Hostal - Iniciar Sesi√≥n</title>
    <link rel="icon" type="image/png" href="assets/girasol.png">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
                        url('assets/Hostal-Principal.jpg') center/cover fixed no-repeat;
            min-height: 100vh;
        }
    </style>
</head>

<body class="bg-light">
    <!-- NAVEGACI√ìN -->
    <nav class="navbar navbar-expand-lg navbar-light bg-warning">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="assets/girasol.png" alt="Logo Hostal" height="40">
                Hostal Los Girasoles
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="habitaciones.html">Habitaciones</a></li>
                    <li class="nav-item"><a class="nav-link active" href="login.html">Iniciar Sesi√≥n</a></li>
                    <li class="nav-item"><a class="nav-link" href="registro.html">Registrarse</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- LOGIN -->
    <section class="py-5 min-vh-100 d-flex align-items-center">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-5 col-lg-4">
                    <div class="text-center mb-4">
                        <img src="assets/girasol.png" alt="Logo Hostal" height="80" class="mb-3">
                        <h2 class="fw-bold text-white">Bienvenido de nuevo</h2>
                        <p class="text-white">Inicia sesi√≥n para gestionar tus reservas</p>
                    </div>

                    <div class="card shadow-lg border-0">
                        <div class="card-body p-4">
                            <!-- ALERTAS -->
                            <div id="alertaLogin" class="alert alert-danger d-none" role="alert">
                                <strong>‚ö†Ô∏è Error:</strong>
                                <span id="mensajeErrorLogin"></span>
                            </div>

                            <div id="alertaExito" class="alert alert-success d-none" role="alert">
                                <strong>‚úì √âxito:</strong> Registro completado. Ya puedes iniciar sesi√≥n.
                            </div>

                            <form id="formLogin" novalidate>
                                <!-- EMAIL -->
                                <div class="mb-3">
                                    <label for="correoLogin" class="form-label fw-bold">
                                        üìß Correo Electr√≥nico
                                    </label>
                                    <input
                                        type="email"
                                        class="form-control form-control-lg"
                                        id="correoLogin"
                                        name="correo"
                                        placeholder="tu@email.com"
                                        required
                                    />
                                    <div class="invalid-feedback">Ingrese un correo v√°lido.</div>
                                </div>

                                <!-- PASSWORD -->
                                <div class="mb-3">
                                    <label for="passwordLogin" class="form-label fw-bold">
                                        üîí Contrase√±a
                                    </label>
                                    <div class="input-group">
                                        <input
                                            type="password"
                                            class="form-control form-control-lg"
                                            id="passwordLogin"
                                            name="password"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            required
                                        />
                                        <button class="btn btn-outline-secondary" type="button" id="togglePasswordLogin">
                                            üëÅÔ∏è
                                        </button>
                                    </div>
                                    <div class="invalid-feedback">Ingrese su contrase√±a.</div>
                                </div>

                                <!-- RECORDAR -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="recordar">
                                    <label class="form-check-label" for="recordar">
                                        Recordar mi sesi√≥n
                                    </label>
                                </div>

                                <!-- BOT√ìN -->
                                <button type="submit" class="btn btn-warning w-100 btn-lg fw-bold mb-3" id="btnLogin">
                                    Iniciar Sesi√≥n
                                </button>

                                <div class="text-center">
                                    <a href="#" class="text-decoration-none text-muted small">
                                        ¬øOlvidaste tu contrase√±a?
                                    </a>
                                </div>
                            </form>

                            <hr class="my-4">

                            <p class="text-center mb-0">
                                ¬øNo tienes cuenta?
                                <a href="registro.html" class="text-warning fw-bold text-decoration-none">
                                    Reg√≠strate aqu√≠
                                </a>
                            </p>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <small class="text-white">
                            Al iniciar sesi√≥n, aceptas nuestros
                            <a href="#" class="text-warning">T√©rminos y Condiciones</a>
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-dark text-white py-3">
        <div class="container text-center">
            <p class="mb-0">&copy; 2026 Hostal Los Girasoles. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/validaciones.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const formLogin = document.getElementById("formLogin");
            const btnLogin = document.getElementById("btnLogin");

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get("registro") === "exitoso") {
                document.getElementById("alertaExito").classList.remove("d-none");
                setTimeout(() => {
                    document.getElementById("alertaExito").classList.add("d-none");
                }, 5000);
            }

            if (formLogin) {
                formLogin.addEventListener("submit", async function (e) {
                    e.preventDefault();

                    btnLogin.disabled = true;
                    btnLogin.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Iniciando...';

                    document.getElementById("alertaLogin").classList.add("d-none");
                    document.getElementById("alertaExito").classList.add("d-none");

                    const correo = document.getElementById("correoLogin").value.trim();
                    const password = document.getElementById("passwordLogin").value;

                    if (!correo || !password) {
                        document.getElementById("mensajeErrorLogin").textContent = "Complete todos los campos.";
                        document.getElementById("alertaLogin").classList.remove("d-none");
                        btnLogin.disabled = false;
                        btnLogin.innerHTML = "Iniciar Sesi√≥n";
                        return;
                    }

                    if (!validarEmail(correo)) {
                        document.getElementById("mensajeErrorLogin").textContent = "Ingrese un correo v√°lido.";
                        document.getElementById("alertaLogin").classList.remove("d-none");
                        document.getElementById("correoLogin").classList.add("is-invalid");
                        btnLogin.disabled = false;
                        btnLogin.innerHTML = "Iniciar Sesi√≥n";
                        return;
                    }

                    const datosLogin = {
                        correo: correo,
                        password: password,
                    };

                    try {
                        const response = await fetch("http://localhost:3000/api/auth/login", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(datosLogin),
                        });

                        const resultado = await response.json();

                        if (response.ok) {
                            sessionStorage.setItem("usuario", JSON.stringify(resultado.usuario));
                            sessionStorage.setItem("token", resultado.token);

                            if (resultado.usuario.tipoUsuario === "admin") {
                                window.location.href = "panel_admin.html";
                            } else {
                                window.location.href = "panel_cliente.html";
                            }
                        } else {
                            document.getElementById("mensajeErrorLogin").textContent = resultado.mensaje || "Credenciales incorrectas. Verifique su correo y contrase√±a.";
                            document.getElementById("alertaLogin").classList.remove("d-none");
                            btnLogin.disabled = false;
                            btnLogin.innerHTML = "Iniciar Sesi√≥n";
                        }
                    } catch (error) {
                        console.error("Error de conexi√≥n:", error);
                        document.getElementById("mensajeErrorLogin").textContent = "Error de conexi√≥n. Int√©ntelo de nuevo en unos segundos.";
                        document.getElementById("alertaLogin").classList.remove("d-none");
                        btnLogin.disabled = false;
                        btnLogin.innerHTML = "Iniciar Sesi√≥n";
                    }
                });

                document.getElementById("correoLogin").addEventListener("input", function () {
                    this.classList.remove("is-invalid");
                    document.getElementById("alertaLogin").classList.add("d-none");
                });

                document.getElementById("passwordLogin").addEventListener("input", function () {
                    this.classList.remove("is-invalid");
                    document.getElementById("alertaLogin").classList.add("d-none");
                });
            }
        });

        document.getElementById("togglePasswordLogin").addEventListener("click", function () {
            const password = document.getElementById("passwordLogin");
            const type = password.type === "password" ? "text" : "password";
            password.type = type;
            this.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
        });
    </script>
</body>
</html>