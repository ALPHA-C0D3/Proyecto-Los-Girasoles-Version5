# ğŸ¯ GUÃA DE INSTALACIÃ“N - SISTEMA DE RECUPERACIÃ“N SIMPLE

## âœ… LO QUE VAS A TENER

Un sistema **SIMPLE** de recuperaciÃ³n de contraseÃ±a:

1. Usuario entra a `solicitar-recuperacion.html`
2. Ingresa su email
3. Recibe email con **BOTÃ“N/LINK**
4. Click en el botÃ³n
5. Se abre `cambiar-password.html`
6. Ingresa nueva contraseÃ±a
7. **LISTO**

**SIN MODALES, SIN PASOS COMPLICADOS, SIN AUTH.JS MODIFICADO**

---

## ğŸ“¦ ARCHIVOS A INSTALAR (5)

### BACKEND (3 archivos)

#### 1. `BackEnd/controllers/authController.js`
- **Buscar:** FunciÃ³n `solicitarRecuperacion`
- **Reemplazar con:** CÃ³digo del archivo `47-authController-SIMPLE.js`
- **Agregar:** FunciÃ³n `resetearPasswordConToken` (estÃ¡ en el mismo archivo)

#### 2. `BackEnd/config/email.js`
- **Agregar al final:** FunciÃ³n `enviarEmailRecuperacionConLink`
- **CÃ³digo:** Archivo `51-email-SIMPLE.js`
- **Modificar exports:** Agregar `enviarEmailRecuperacionConLink`

#### 3. `BackEnd/routes/auth.routes.js`
- **Agregar:** Importar `resetearPasswordConToken`
- **Agregar ruta:** `router.post('/resetear-password-token', resetearPasswordConToken);`

### FRONTEND (2 archivos)

#### 4. `FrontEnd/solicitar-recuperacion.html` (NUEVO)
- **Archivo:** `52-solicitar-recuperacion.html`
- **DescripciÃ³n:** PÃ¡gina donde el usuario ingresa su email

#### 5. `FrontEnd/cambiar-password.html` (NUEVO)
- **Archivo:** `53-cambiar-password.html`
- **DescripciÃ³n:** PÃ¡gina donde el usuario cambia su contraseÃ±a (recibe token por URL)

#### 6. `FrontEnd/login.html` (MODIFICAR)
- **Ver:** `54-MODIFICAR-LOGIN.txt`
- **Cambio:** Reemplazar el enlace de "Â¿Olvidaste tu contraseÃ±a?" para que vaya a `solicitar-recuperacion.html`

---

## ğŸš€ INSTALACIÃ“N PASO A PASO

### PASO 1: Backend - authController.js

```bash
cd BackEnd/controllers
# Hacer backup
cp authController.js authController.js.backup
```

Abrir `authController.js` y:

1. **Buscar la funciÃ³n `solicitarRecuperacion`**
2. **Reemplazarla completamente** con el cÃ³digo del archivo `47-authController-SIMPLE.js`
3. **Agregar al final** (antes de `module.exports`) la funciÃ³n `resetearPasswordConToken` que estÃ¡ en el mismo archivo

Verificar que estÃ©:
- âœ… `exports.solicitarRecuperacion` - Modificada
- âœ… `exports.resetearPasswordConToken` - Nueva

---

### PASO 2: Backend - email.js

```bash
cd BackEnd/config
# Hacer backup
cp email.js email.js.backup
```

Abrir `email.js` y:

1. **Al final del archivo, ANTES de `module.exports`**, agregar la funciÃ³n completa del archivo `51-email-SIMPLE.js`

2. **Modificar la lÃ­nea `module.exports`** para incluir la nueva funciÃ³n:

```javascript
module.exports = {
    enviarEmail,
    enviarCodigoVerificacion,
    enviarCodigoRecuperacion,
    enviarEmailRecuperacionConLink  // â† AGREGAR ESTA
};
```

---

### PASO 3: Backend - auth.routes.js

```bash
cd BackEnd/routes
# Hacer backup
cp auth.routes.js auth.routes.js.backup
```

Abrir `auth.routes.js` y:

1. **En la secciÃ³n de imports**, agregar `resetearPasswordConToken`:

```javascript
const { 
    registro, 
    login, 
    // ... otras funciones ...
    resetearPasswordConToken  // â† AGREGAR
} = require('../controllers/authController');
```

2. **Al final, ANTES de `module.exports`**, agregar la ruta:

```javascript
router.post('/resetear-password-token', resetearPasswordConToken);
```

---

### PASO 4: Frontend - Nuevas pÃ¡ginas

```bash
cd FrontEnd
```

1. Copiar archivo `52-solicitar-recuperacion.html` y renombrarlo a `solicitar-recuperacion.html`
2. Copiar archivo `53-cambiar-password.html` y renombrarlo a `cambiar-password.html`

Estructura debe quedar:
```
FrontEnd/
â”œâ”€â”€ login.html
â”œâ”€â”€ solicitar-recuperacion.html  â† NUEVO
â”œâ”€â”€ cambiar-password.html        â† NUEVO
â”œâ”€â”€ assets/
â”œâ”€â”€ css/
â””â”€â”€ js/
```

---

### PASO 5: Frontend - Modificar login.html

Abrir `login.html` y buscar el botÃ³n "Iniciar SesiÃ³n".

DespuÃ©s del botÃ³n, busca:
```html
<div class="text-center">
    <a href="#" ... data-bs-toggle="modal" ...>
        Â¿Olvidaste tu contraseÃ±a?
    </a>
</div>
```

**Reemplazar con:**
```html
<div class="text-center">
    <a href="solicitar-recuperacion.html" class="text-decoration-none text-warning fw-bold">
        Â¿Olvidaste tu contraseÃ±a?
    </a>
</div>
```

Guardar y cerrar.

---

### PASO 6: Configurar URL del Frontend en Backend

Abrir `BackEnd/.env` y agregar:

```env
FRONTEND_URL=http://127.0.0.1:5500
```

(Si usas Live Server en otro puerto, cambia el nÃºmero)

---

## ğŸ§ª TESTING COMPLETO

### Test 1: Iniciar Backend

```bash
cd BackEnd
npm start
```

Debes ver:
```
Servidor corriendo en puerto 3000
```

---

### Test 2: Solicitar recuperaciÃ³n

1. Abre en navegador: `http://127.0.0.1:5500/solicitar-recuperacion.html`
2. Ingresa un email que exista en tu base de datos
3. Click en "Enviar Enlace de RecuperaciÃ³n"

**En consola del navegador:**
```
ğŸ“§ Solicitando recuperaciÃ³n para: tu@email.com
ğŸ“¥ Respuesta: {success: true, mensaje: "...", link: "http://..."}
âœ… Email enviado exitosamente
```

**En consola del backend:**
```
[RECUPERACIÃ“N] Token generado para tu@email.com: abc123...
[RECUPERACIÃ“N] Link generado: http://127.0.0.1:5500/cambiar-password.html?token=abc123...
ğŸ“§ Enviando email de recuperaciÃ³n a: tu@email.com
âœ… Email enviado exitosamente a tu@email.com
```

**En tu email:**
- Debes recibir un email con un botÃ³n amarillo "Cambiar mi ContraseÃ±a"

---

### Test 3: Cambiar contraseÃ±a

**OpciÃ³n A - Desde el email:**
1. Abre el email que recibiste
2. Click en el botÃ³n "Cambiar mi ContraseÃ±a"
3. Se abre `cambiar-password.html?token=...`

**OpciÃ³n B - Desde desarrollo:**
1. En la pÃ¡gina de `solicitar-recuperacion.html` aparecerÃ¡ un botÃ³n "Abrir Link de RecuperaciÃ³n" (SOLO EN DESARROLLO)
2. Click en ese botÃ³n

**En la pÃ¡gina de cambiar contraseÃ±a:**
1. Ingresa tu nueva contraseÃ±a (mÃ­nimo 6 caracteres)
2. Confirma la contraseÃ±a
3. Click en "Cambiar ContraseÃ±a"

**En consola del navegador:**
```
ğŸ”‘ Token desde URL: abc123...
âœ… Token encontrado, mostrando formulario
ğŸ” Enviando nueva contraseÃ±a al backend...
ğŸ“¥ Respuesta: {success: true, mensaje: "ContraseÃ±a actualizada exitosamente"}
âœ… ContraseÃ±a cambiada exitosamente
```

**Resultado:**
- VerÃ¡s mensaje de Ã©xito âœ…
- BotÃ³n "Ir al Login"
- Puedes hacer login con tu nueva contraseÃ±a

---

## ğŸ¯ FLUJO VISUAL COMPLETO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ login.html              â”‚
â”‚ Click: Â¿Olvidaste...?   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ solicitar-recuperacion  â”‚
â”‚ Ingresa email           â”‚
â”‚ Click: Enviar           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND                 â”‚
â”‚ - Genera token          â”‚
â”‚ - Guarda en DB          â”‚
â”‚ - EnvÃ­a email con link  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EMAIL                   â”‚
â”‚ [BotÃ³n: Cambiar mi      â”‚
â”‚  ContraseÃ±a]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ (click)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cambiar-password.html   â”‚
â”‚ ?token=abc123...        â”‚
â”‚ Ingresa nueva password  â”‚
â”‚ Click: Cambiar          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND                 â”‚
â”‚ - Verifica token        â”‚
â”‚ - Actualiza password    â”‚
â”‚ - Limpia token          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Ã‰XITO                â”‚
â”‚ Ir al Login             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âŒ TROUBLESHOOTING

### Email no llega

1. Verificar que Resend API key estÃ© en `.env`
2. Verificar logs del backend
3. Revisar carpeta de spam
4. En desarrollo, usar el link que aparece en pantalla

### "Token invÃ¡lido"

1. Verificar que la URL tiene `?token=...`
2. El token expira en 30 minutos
3. Solicitar nuevo link

### Error de conexiÃ³n

1. Verificar que backend estÃ© corriendo (`npm start`)
2. Verificar que el puerto sea 3000
3. Verificar que `API_URL` en HTML sea `http://localhost:3000/api`

---

## âœ… CHECKLIST FINAL

- [ ] authController.js modificado
- [ ] email.js con nueva funciÃ³n
- [ ] auth.routes.js con nueva ruta
- [ ] solicitar-recuperacion.html creado
- [ ] cambiar-password.html creado
- [ ] login.html modificado (link simple)
- [ ] FRONTEND_URL en .env configurado
- [ ] Backend corriendo
- [ ] Email llega correctamente
- [ ] Link funciona
- [ ] ContraseÃ±a se cambia
- [ ] Login funciona con nueva contraseÃ±a

---

## ğŸ‰ VENTAJAS DE ESTE SISTEMA

âœ… **SIMPLE** - Solo 2 pÃ¡ginas HTML
âœ… **SIN MODAL** - Sin problemas de cambio de pasos
âœ… **SIN AUTH.JS COMPLICADO** - No requiere modificar auth.js
âœ… **MÃS SEGURO** - Usa token Ãºnico en lugar de cÃ³digo
âœ… **MEJOR UX** - Usuario hace click en email y ya
âœ… **FÃCIL DE DEBUGGEAR** - Logs claros en cada paso
âœ… **FUNCIONA 100%** - Sin margen de error

---

**Â¡ESTE SISTEMA SÃ VA A FUNCIONAR!** ğŸš€
